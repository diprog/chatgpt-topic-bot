<!DOCTYPE html>
<html>
<body>
<section id="main_view" style="display: none">
    <h1>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏</h1>
    <hr>
    <p>
        <span class="mono">temperature</span>&nbsp;&nbsp;<a href="javascript:void()" class="hint_button"
                                                 onclick="switchView('temperature_hint_view')">(?)</a>
        <br><span class="number_range_hint">–æ—Ç 0.0 –¥–æ 2.0</span>
    </p>
    <input class="text_input" type=number step=0.1 onchange="onTextInputChange()">
    <p>
        <span class="mono">top_p</span>&nbsp;&nbsp;<a href="javascript:void()" class="hint_button"
                                           onclick="switchView('top_p_hint_view')">(?)</a>
        <br><span class="number_range_hint">–æ—Ç 0.0 –¥–æ 1.0</span>
    </p>
    <input class="text_input" type=number step=0.1 onchange="onTextInputChange()">
    <p>
        <span class="mono">presence_penalty</span>&nbsp;&nbsp;<a href="javascript:void()" class="hint_button"
                                                      onclick="switchView('presence_penalty_hint_view')">(?)</a>
        <br><span class="number_range_hint">–æ—Ç -2.0 –¥–æ 2.0</span>
    </p>
    <input class="text_input" type=number step=0.1 onchange="onTextInputChange()">
    <p><span class="mono">frequency_penalty</span>&nbsp;&nbsp;<a href="javascript:void()" class="hint_button"
                                                      onclick="switchView('frequency_penalty_hint_view')">(?)</a><br><span class="number_range_hint">–æ—Ç -2.0 –¥–æ 2.0</span></p>
    <input class="text_input" type=number step=0.1 onchange="onTextInputChange()">
    <p></p>
    <a href="javascript:void()" onclick="resetSettings()" style="font-size: 14px">üîÑ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</a>
    <button disabled id="save_btn" onclick="saveUserChatGPTSettings(() => showAlert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.'))">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</section>
<section id="temperature_hint_view" class="param_hint">
    ‚ùî
    <h3>temperature<br>
        <span>(float)</span>
    </h3>
    <hr>
    <p>–ü–∞—Ä–∞–º–µ—Ç—Ä <span>temperature</span> –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.<br><br>–ß–µ–º –≤—ã—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–µ–º –±–æ–ª–µ–µ –Ω–æ–≤—ã–µ –∏
        –Ω–µ–æ–±—ã—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç—å.<br><br>–í—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º, –ø–æ—Å–∫–æ–ª—å–∫—É
        —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ
        –Ω–∏–∑–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã–µ —Å–ª–æ–≤–∞ –±—É–¥—É—Ç –≤—ã–±—Ä–∞–Ω—ã –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.</p>
    <br>
    <button onclick="switchView('main_view')">‚úï –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É</button>
</section>
<section id="top_p_hint_view" class="param_hint">
    ‚ùî
    <h3>top_p<br>
        <span>(float)</span>
    </h3>
    <hr>
    <p>–ü–∞—Ä–∞–º–µ—Ç—Ä <span>top_p</span>, —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ nucleus sampling, –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –ø–æ—Ä–æ–≥ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –Ω–∞
        –≤—ã–±–æ—Ä–∫—É —Å–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω—ã, —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç.<br><br>–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç top_k, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–µ–∑–∞–µ—Ç
        –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∫–∏ –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã—Ö —Å–ª–æ–≤, top_p –∑–∞–¥–∞–µ—Ç –ø–æ—Ä–æ–≥ –Ω–∞ —Å—É–º–º—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã—Ö
        —Å–ª–æ–≤, —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–Ω—É—é –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ –æ—á–µ–Ω—å
        –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–æ —Å–∞–º–æ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ–µ.</p>
    <br>
    <button onclick="switchView('main_view')">‚úï –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É</button>
</section>
<section id="presence_penalty_hint_view" class="param_hint">
    ‚ùî
    <h3>presence_penalty<br>
        <span>(float)</span>
    </h3>
    <hr>
    <p>–≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Ä–∞–Ω–µ–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–∞–º, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –∏—Ö –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
        –ø–æ—è–≤–ª–µ–Ω–∏—è –≤ –≤—ã—Ö–æ–¥–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.<br><br>–≠—Ç–∏ —Ç–æ–∫–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ —É—á–µ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –≤—ã—Ö–æ–¥–Ω–æ–π
        –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —Ñ—Ä–∞–∑ –∏ —Å–ª–æ–≤.</p>
    <br>
    <button onclick="switchView('main_view')">‚úï –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É</button>
</section>
<section id="frequency_penalty_hint_view" class="param_hint">
    ‚ùî
    <h3>frequency_penalty<br>
        <span>(float)</span>
    </h3>
    <hr>
    <p>–ü–∞—Ä–∞–º–µ—Ç—Ä <span>frequency_penalty</span> —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å —Ä–∞–Ω–µ–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏ –∏
        –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç
        —á–∞—Å—Ç–æ—Ç—É –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.<br><br>–≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, –µ—Å–ª–∏ –≤—ã
        –±–µ—Å–ø–æ–∫–æ–∏—Ç–µ—Å—å –æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ —Ñ—Ä–∞–∑ –∏ —Å–ª–æ–≤ –≤ –º–∞–ª–µ–Ω—å–∫–∏—Ö –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è—Ö.<br><br>–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç
        –ø—Ä–∏—Å—É–∂–¥–∞—Ç—å –º–µ–Ω—å—à–∏–µ —à—Ç—Ä–∞—Ñ—ã –∑–∞ —Ç–æ–∫–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ä–µ–∂–µ –≤ –∫–æ–Ω–µ—á–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ
        —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.</p>
    <br>
    <button onclick="switchView('main_view')">‚úï –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É</button>
</section>
</body>
<script>
    let user_chatgpt_settings = {};
    let text_inputs = $('*[class=text_input]');
    getUserChatGPTSettings();
    // $('#save_btn').prop('disabled', true);
    let views = [];
    $('*[id*=_view]').each(function (i, el) {
        views.push(el);
    });

    function switchView(view_id) {
        views.forEach((element) => {
            if ($(element).is(":visible")) {
                $(element).fadeOut(100, () => {
                    $(window).scrollTop(0);
                    $('#' + view_id).fadeIn(100);
                });
            }

        });
    }

    function dataCorrect() {
        let number = text_inputs[0].value;
        if (!(number >= 0 && number <= 2)) {
            return false;
        }
        number = text_inputs[1].value;
        if (!(number >= 0 && number <= 1)) {
            return false;
        }
        number = text_inputs[2].value;
        if (!(number >= -2 && number <= 2)) {
            return false;
        }
        number = text_inputs[3].value;
        if (!(number >= -2 && number <= 2)) {
            return false;
        }
        return true;
    }

    function onTextInputChange() {
        if (dataCorrect()) {
            $('#save_btn').prop('disabled', false);
        } else {
            $('#save_btn').prop('disabled', true);
        }

    }

    function init(response) {
        user_chatgpt_settings = response;
        text_inputs[0].value = response.temperature;
        text_inputs[1].value = response.top_p;
        text_inputs[2].value = response.presence_penalty;
        text_inputs[3].value = response.frequency_penalty;
        $('#main_view').fadeIn(100);
    }

    function resetSettings() {
        text_inputs[0].value = 1.0;
        text_inputs[1].value = 1.0;
        text_inputs[2].value = 0.0;
        text_inputs[3].value = 0.0;
        saveUserChatGPTSettings(() => showAlert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.'));
    }

    function showAlert(message) {
        Telegram.WebApp.showAlert(message);
    }

    function getUserChatGPTSettings() {
        if (!initDataUnsafe.query_id) {
            alert('WebViewQueryId not defined');
            return;
        }
        $.ajax('/webapp/getUserChatGPTSettings', {
            type: 'POST',
            data: {
                _auth: initData,
                _unsafe_data: initDataUnsafe,
            },
            dataType: 'json',
            success: function (result) {
                console.log(result)
                if (result) {
                    init(result);
                } else {
                    alert('–∞ error');
                }
            },
            error: function (xhr) {
                //$('button').prop('disabled', false);
                //$('#btn_status').text('Server error').addClass('err').show();
                alert('Server error');
            }
        });
    }

    function saveUserChatGPTSettings(on_success) {

        if (!initDataUnsafe.query_id) {
            alert('WebViewQueryId not defined');
            return;
        }
        $.ajax('/webapp/saveUserChatGPTSettings', {
            type: 'POST',
            data: {
                _auth: initData,
                _unsafe_data: initDataUnsafe,
                settings: {
                    temperature: text_inputs[0].value,
                    top_p: text_inputs[1].value,
                    presence_penalty: text_inputs[2].value,
                    frequency_penalty: text_inputs[3].value,
                }
            },
            dataType: 'json',
            success: function (result) {
                console.log(result)
                if (result) {
                    $('#save_btn').prop('disabled', true);
                    on_success();
                } else {
                    alert('–∞ error');
                }
            },
            error: function (xhr) {
                alert('Server error');
            }
        });
    }
</script>
</html>